#! /home/amancinelli/CBQN/BQN

"

BQN Lisp-MLIR Compiler
============================================

    Usage:
      ./c.bqn <path to lisp file> <path to output file>

============================================
" ! 2=â‰ â€¢args

sâ†â€¢file.Chars 0âŠ‘â€¢args
ofâ†1âŠ‘â€¢args

âŸ¨feâŸ©â†â€¢Import "fe.bqn"
âŸ¨treeâŸ©â†â€¢Import "t.bqn"
âŸ¨cgâŸ©â†â€¢Import "cg.bqn"

fe.Tokenize s
fe.DumpToks@

toks â† fe.toks
â€¢Out "
============================================
          Tokenized Syntax Tree
============================================
"
â€¢Show tâ†Tree toks

Compile â† {
  cc â† âŸ¨
    "mlir-opt",
    "--pass-pipeline=func.func(tosa-infer-shapes, tosa-to-linalg-named, tosa-to-linalg, canonicalize, arith-expand, canonicalize)",
    "--func-bufferize",
    "--pass-pipeline=func.func(canonicalize, convert-linalg-to-affine-loops, affine-loop-fusion, lower-affine, finalizing-bufferize, buffer-deallocation, convert-scf-to-cf, convert-math-to-llvm)",
    "--convert-arith-to-llvm",
    "--convert-vector-to-llvm",
    "--convert-cf-to-llvm",
    "--convert-memref-to-llvm",
    "--convert-func-to-llvm",
    "--canonicalize",
    "--reconcile-unrealized-casts",
    "--canonicalize",
    "--llvm-legalize-for-export",
    ğ•©
  âŸ©
  râ€¿oâ€¿e â† â€¢Sh cc
  â€¢Out 0âŠ¸=â—¶{ğ•Š:"Error occured: "âˆ¾e}â€¿{ğ•Š:"compilation succeeded"}r
}

mlir â† ofâˆ¾".mlir"
â€¢Show mlir CG t
of Compile mlir

